<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Agent OS Policy Reference - Comprehensive guide to policy-based governance, built-in policies, custom policy creation, and violation handling.">
    <meta name="keywords" content="Agent OS Policy, Policy Engine, Security Governance, AI Agent Policies, HIPAA, SOC2, Pattern Matching">
    <meta name="author" content="Imran Siddique">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://imran-siddique.github.io/agent-os/docs/policies.html">
    
    <!-- Open Graph -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://imran-siddique.github.io/agent-os/docs/policies.html">
    <meta property="og:title" content="Policy Reference - Agent OS">
    <meta property="og:description" content="Comprehensive guide to policy-based governance for AI agents.">
    <meta property="og:site_name" content="Agent OS">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <title>Policy Reference - Agent OS | Imran Siddique</title>
    <link rel="stylesheet" href="../../styles-new.css">
    <link rel="stylesheet" href="../assets/agent-os.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="../../index.html" class="logo">Imran Siddique</a>
            <ul class="nav-links">
                <li><a href="../../index.html">Home</a></li>
                <li><a href="../../about.html">About</a></li>
                <li><a href="../../projects.html">Projects</a></li>
                <li><a href="../index.html" class="active">Agent OS</a></li>
                <li><a href="../../writings.html">Writings</a></li>
                <li><a href="../../contact.html">Contact</a></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <main>
        <!-- Hero Section -->
        <section class="aos-docs-hero">
            <div class="container">
                <h1><span class="gradient">Policy Reference</span></h1>
                <p>Comprehensive guide to policy-based governance for AI agents</p>
            </div>
        </section>

        <!-- Documentation Content -->
        <section class="aos-docs-content">
            <div class="container">
                <div class="aos-docs-layout">
                    <!-- Sidebar Navigation -->
                    <aside class="aos-sidebar">
                        <nav class="aos-sidebar-nav">
                            <h4 class="aos-sidebar-title">Overview</h4>
                            <ul>
                                <li><a href="#overview">Policy Concepts</a></li>
                                <li><a href="#how-it-works">How Policies Work</a></li>
                            </ul>
                        </nav>
                        <nav class="aos-sidebar-nav">
                            <h4 class="aos-sidebar-title">Built-in Policies</h4>
                            <ul>
                                <li><a href="#strict">strict</a></li>
                                <li><a href="#permissive">permissive</a></li>
                                <li><a href="#read-only">read_only</a></li>
                            </ul>
                        </nav>
                        <nav class="aos-sidebar-nav">
                            <h4 class="aos-sidebar-title">Custom Policies</h4>
                            <ul>
                                <li><a href="#policy-class">Policy Class</a></li>
                                <li><a href="#pattern-class">Pattern Class</a></li>
                                <li><a href="#yaml-config">YAML Configuration</a></li>
                            </ul>
                        </nav>
                        <nav class="aos-sidebar-nav">
                            <h4 class="aos-sidebar-title">Reference</h4>
                            <ul>
                                <li><a href="#action-types">Action Types</a></li>
                                <li><a href="#pattern-matching">Pattern Matching</a></li>
                                <li><a href="#violation-handling">Violation Handling</a></li>
                            </ul>
                        </nav>
                        <nav class="aos-sidebar-nav">
                            <h4 class="aos-sidebar-title">Templates</h4>
                            <ul>
                                <li><a href="#hipaa-standard">hipaa_standard</a></li>
                                <li><a href="#soc2-compliant">soc2_compliant</a></li>
                                <li><a href="#k12-safe">k12_safe</a></li>
                            </ul>
                        </nav>
                        <nav class="aos-sidebar-nav">
                            <h4 class="aos-sidebar-title">Advanced</h4>
                            <ul>
                                <li><a href="#combining-policies">Combining Policies</a></li>
                                <li><a href="#dynamic-policies">Dynamic Policies</a></li>
                            </ul>
                        </nav>
                    </aside>

                    <!-- Main Content -->
                    <div class="aos-main">
                        <!-- Overview -->
                        <h2 id="overview">Policy-Based Governance</h2>
                        <p>
                            Agent OS implements a comprehensive policy-based governance system that controls what actions 
                            AI agents can perform. Policies act as security boundaries, ensuring agents operate within 
                            defined constraints while maintaining full auditability of all actions.
                        </p>
                        <p>
                            The policy engine evaluates every agent action against a set of rules before execution. 
                            If an action violates a policy, the engine can block it, warn about it, or log it 
                            depending on the configured violation handling mode.
                        </p>

                        <h3 id="how-it-works">How Policies Work</h3>
                        <p>
                            When an agent attempts any action, the kernel intercepts the request and passes it 
                            through the policy engine. The engine evaluates the action against all configured 
                            patterns and determines the appropriate response.
                        </p>
                        <div class="aos-code-block">
                            <pre><code># Policy evaluation flow
from agent_os import KernelSpace, Policy

kernel = KernelSpace(policy="strict")

# When an agent tries to write a file:
# 1. Action intercepted: file_write("/etc/passwd", content)
# 2. Policy engine evaluates against patterns
# 3. Pattern match found: /etc/* is blocked
# 4. SIGKILL signal sent to agent
# 5. Action logged to FlightRecorder</code></pre>
                        </div>

                        <!-- Built-in Policies -->
                        <h2 id="builtin-policies">Built-in Policies</h2>
                        <p>
                            Agent OS ships with three built-in policies designed for common use cases. 
                            These policies can be used directly or extended to create custom policies.
                        </p>

                        <h3 id="strict">strict</h3>
                        <p>
                            The <strong>strict</strong> policy is the default and most restrictive policy. 
                            It blocks all potentially dangerous operations and requires explicit permission 
                            for sensitive actions.
                        </p>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import KernelSpace

# Use strict policy (default)
kernel = KernelSpace(policy="strict")</code></pre>
                        </div>
                        <table class="aos-table">
                            <thead>
                                <tr>
                                    <th>Action Type</th>
                                    <th>Behavior</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>file_read</code></td>
                                    <td>Allowed for non-sensitive paths; blocks /etc/*, ~/.ssh/*, /proc/*</td>
                                </tr>
                                <tr>
                                    <td><code>file_write</code></td>
                                    <td>Blocked for system directories; allowed in designated workspaces</td>
                                </tr>
                                <tr>
                                    <td><code>file_delete</code></td>
                                    <td>Blocked outside workspace; requires confirmation for batch deletes</td>
                                </tr>
                                <tr>
                                    <td><code>shell_execute</code></td>
                                    <td>Blocked for dangerous commands (rm -rf, sudo, chmod 777)</td>
                                </tr>
                                <tr>
                                    <td><code>network_request</code></td>
                                    <td>Blocked for internal networks; allowed for whitelisted domains</td>
                                </tr>
                                <tr>
                                    <td><code>database_write</code></td>
                                    <td>Requires explicit permission; all queries logged</td>
                                </tr>
                                <tr>
                                    <td><code>database_delete</code></td>
                                    <td>Blocked; requires elevated privileges</td>
                                </tr>
                            </tbody>
                        </table>

                        <h3 id="permissive">permissive</h3>
                        <p>
                            The <strong>permissive</strong> policy allows most operations but still blocks 
                            critical system-level actions. Suitable for development environments where 
                            agents need more freedom.
                        </p>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import KernelSpace

# Use permissive policy for development
kernel = KernelSpace(policy="permissive")</code></pre>
                        </div>
                        <table class="aos-table">
                            <thead>
                                <tr>
                                    <th>Action Type</th>
                                    <th>Behavior</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>file_read</code></td>
                                    <td>Allowed everywhere except /proc/*, /sys/*</td>
                                </tr>
                                <tr>
                                    <td><code>file_write</code></td>
                                    <td>Allowed everywhere except /etc/*, /usr/*, /bin/*</td>
                                </tr>
                                <tr>
                                    <td><code>file_delete</code></td>
                                    <td>Allowed with warning; blocked for system files</td>
                                </tr>
                                <tr>
                                    <td><code>shell_execute</code></td>
                                    <td>Allowed with logging; blocks only sudo and privilege escalation</td>
                                </tr>
                                <tr>
                                    <td><code>network_request</code></td>
                                    <td>Allowed; logs all external connections</td>
                                </tr>
                                <tr>
                                    <td><code>database_*</code></td>
                                    <td>Allowed with logging; blocks DROP DATABASE, TRUNCATE</td>
                                </tr>
                            </tbody>
                        </table>

                        <h3 id="read-only">read_only</h3>
                        <p>
                            The <strong>read_only</strong> policy restricts agents to observation-only mode. 
                            No modifications to files, databases, or external systems are permitted.
                        </p>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import KernelSpace

# Use read-only policy for analysis tasks
kernel = KernelSpace(policy="read_only")</code></pre>
                        </div>
                        <table class="aos-table">
                            <thead>
                                <tr>
                                    <th>Action Type</th>
                                    <th>Behavior</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>file_read</code></td>
                                    <td>Allowed for all non-sensitive paths</td>
                                </tr>
                                <tr>
                                    <td><code>file_write</code></td>
                                    <td><strong>Blocked</strong> - all write operations denied</td>
                                </tr>
                                <tr>
                                    <td><code>file_delete</code></td>
                                    <td><strong>Blocked</strong> - all delete operations denied</td>
                                </tr>
                                <tr>
                                    <td><code>shell_execute</code></td>
                                    <td>Allowed for read-only commands (ls, cat, grep, find)</td>
                                </tr>
                                <tr>
                                    <td><code>network_request</code></td>
                                    <td>GET requests only; POST/PUT/DELETE blocked</td>
                                </tr>
                                <tr>
                                    <td><code>database_read</code></td>
                                    <td>Allowed - SELECT queries permitted</td>
                                </tr>
                                <tr>
                                    <td><code>database_write</code></td>
                                    <td><strong>Blocked</strong> - INSERT/UPDATE denied</td>
                                </tr>
                                <tr>
                                    <td><code>database_delete</code></td>
                                    <td><strong>Blocked</strong> - DELETE/DROP denied</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Custom Policies -->
                        <h2 id="custom-policies">Custom Policies in Python</h2>
                        <p>
                            For fine-grained control, you can create custom policies using the <code>Policy</code> 
                            and <code>Pattern</code> classes. Custom policies allow you to define exactly which 
                            actions are permitted, denied, or flagged for review.
                        </p>

                        <h3 id="policy-class">Policy Class</h3>
                        <p>
                            The <code>Policy</code> class is the main container for policy rules. It holds 
                            a collection of patterns and defines the default behavior for unmatched actions.
                        </p>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import Policy, Pattern
from agent_os.policy import Severity, ViolationMode

# Create a custom policy
policy = Policy(
    name="my_custom_policy",
    description="Custom policy for my application",
    version="1.0.0",
    default_action="allow",      # allow, deny, or warn
    violation_mode=ViolationMode.SIGKILL,
    patterns=[]                   # List of Pattern objects
)</code></pre>
                        </div>
                        <table class="aos-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>name</code></td>
                                    <td><code>str</code></td>
                                    <td>Unique identifier for the policy</td>
                                </tr>
                                <tr>
                                    <td><code>description</code></td>
                                    <td><code>str</code></td>
                                    <td>Human-readable description</td>
                                </tr>
                                <tr>
                                    <td><code>version</code></td>
                                    <td><code>str</code></td>
                                    <td>Semantic version for tracking changes</td>
                                </tr>
                                <tr>
                                    <td><code>default_action</code></td>
                                    <td><code>str</code></td>
                                    <td>Action when no pattern matches: allow, deny, warn</td>
                                </tr>
                                <tr>
                                    <td><code>violation_mode</code></td>
                                    <td><code>ViolationMode</code></td>
                                    <td>How to handle policy violations</td>
                                </tr>
                                <tr>
                                    <td><code>patterns</code></td>
                                    <td><code>List[Pattern]</code></td>
                                    <td>List of patterns to evaluate</td>
                                </tr>
                            </tbody>
                        </table>

                        <h4>Policy Methods</h4>
                        <div class="aos-code-block">
                            <pre><code># Add a pattern to the policy
policy.add_pattern(Pattern(
    action_type="file_write",
    pattern=r"/var/log/.*",
    action="allow"
))

# Remove a pattern by ID
policy.remove_pattern("pattern_id")

# Evaluate an action against the policy
result = policy.evaluate(
    action_type="file_write",
    target="/var/log/app.log",
    context={"agent_id": "agent_123"}
)

# Check if action is allowed
if result.allowed:
    print("Action permitted")
else:
    print(f"Action blocked: {result.reason}")

# Export policy to YAML
yaml_str = policy.to_yaml()

# Load policy from YAML file
policy = Policy.from_yaml("path/to/policy.yaml")

# Merge with another policy
merged = policy.merge(other_policy, strategy="strict")</code></pre>
                        </div>

                        <h3 id="pattern-class">Pattern Class</h3>
                        <p>
                            The <code>Pattern</code> class defines individual rules within a policy. 
                            Each pattern matches specific action types and targets using regular expressions.
                        </p>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import Pattern
from agent_os.policy import Severity

# Create a pattern to block SSH key access
ssh_pattern = Pattern(
    id="block_ssh_keys",
    action_type="file_read",
    pattern=r".*\.ssh/.*",
    action="deny",
    severity=Severity.CRITICAL,
    message="Access to SSH keys is not permitted",
    metadata={
        "category": "security",
        "compliance": ["SOC2", "HIPAA"]
    }
)

# Create a pattern with conditions
conditional_pattern = Pattern(
    id="limit_large_writes",
    action_type="file_write",
    pattern=r".*",
    action="warn",
    severity=Severity.MEDIUM,
    conditions={
        "max_size_bytes": 10485760,  # 10MB
        "require_confirmation": True
    }
)

# Create a network whitelist pattern
network_pattern = Pattern(
    id="allowed_apis",
    action_type="network_request",
    pattern=r"https://(api\.github\.com|api\.openai\.com)/.*",
    action="allow",
    severity=Severity.LOW
)</code></pre>
                        </div>
                        <table class="aos-table">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>id</code></td>
                                    <td><code>str</code></td>
                                    <td>Unique identifier for the pattern (auto-generated if not provided)</td>
                                </tr>
                                <tr>
                                    <td><code>action_type</code></td>
                                    <td><code>str</code></td>
                                    <td>The type of action to match (see Action Types)</td>
                                </tr>
                                <tr>
                                    <td><code>pattern</code></td>
                                    <td><code>str</code></td>
                                    <td>Regular expression to match against the target</td>
                                </tr>
                                <tr>
                                    <td><code>action</code></td>
                                    <td><code>str</code></td>
                                    <td>What to do on match: allow, deny, warn</td>
                                </tr>
                                <tr>
                                    <td><code>severity</code></td>
                                    <td><code>Severity</code></td>
                                    <td>LOW, MEDIUM, HIGH, CRITICAL</td>
                                </tr>
                                <tr>
                                    <td><code>message</code></td>
                                    <td><code>str</code></td>
                                    <td>Human-readable message for violations</td>
                                </tr>
                                <tr>
                                    <td><code>conditions</code></td>
                                    <td><code>dict</code></td>
                                    <td>Additional conditions for matching</td>
                                </tr>
                                <tr>
                                    <td><code>metadata</code></td>
                                    <td><code>dict</code></td>
                                    <td>Arbitrary metadata for categorization</td>
                                </tr>
                            </tbody>
                        </table>

                        <h4>Complete Custom Policy Example</h4>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import KernelSpace, Policy, Pattern
from agent_os.policy import Severity, ViolationMode

# Create a custom policy for a data processing application
data_policy = Policy(
    name="data_processor_policy",
    description="Policy for data processing agents",
    version="2.1.0",
    default_action="deny",
    violation_mode=ViolationMode.SIGKILL
)

# Allow reading from data directories
data_policy.add_pattern(Pattern(
    id="read_data_dirs",
    action_type="file_read",
    pattern=r"/data/(input|staging|archive)/.*",
    action="allow",
    severity=Severity.LOW
))

# Allow writing to output directory only
data_policy.add_pattern(Pattern(
    id="write_output",
    action_type="file_write",
    pattern=r"/data/output/.*",
    action="allow",
    severity=Severity.LOW
))

# Block all other file writes
data_policy.add_pattern(Pattern(
    id="block_other_writes",
    action_type="file_write",
    pattern=r".*",
    action="deny",
    severity=Severity.HIGH,
    message="File writes only allowed in /data/output/"
))

# Allow database reads
data_policy.add_pattern(Pattern(
    id="db_read",
    action_type="database_read",
    pattern=r".*",
    action="allow"
))

# Block database writes with warning
data_policy.add_pattern(Pattern(
    id="db_write_warn",
    action_type="database_write",
    pattern=r".*",
    action="warn",
    severity=Severity.MEDIUM,
    message="Database write detected - ensure data validation"
))

# Block dangerous shell commands
data_policy.add_pattern(Pattern(
    id="block_dangerous_shell",
    action_type="shell_execute",
    pattern=r".*(rm\s+-rf|sudo|chmod\s+777|mkfs|dd\s+if=).*",
    action="deny",
    severity=Severity.CRITICAL,
    message="Dangerous shell command blocked"
))

# Allow specific network endpoints
data_policy.add_pattern(Pattern(
    id="allowed_endpoints",
    action_type="network_request",
    pattern=r"https://(api\.internal\.com|storage\.cloud\.com)/.*",
    action="allow"
))

# Use the policy
kernel = KernelSpace(policy=data_policy)</code></pre>
                        </div>

                        <!-- YAML Configuration -->
                        <h2 id="yaml-config">YAML Configuration Format</h2>
                        <p>
                            Policies can be defined in YAML files for easier management and version control. 
                            The YAML format supports all features available in the Python API.
                        </p>
                        <div class="aos-code-block">
                            <pre><code># policy.yaml - Complete policy configuration example

name: enterprise_security_policy
description: Security policy for enterprise deployments
version: "3.0.0"
author: security-team@company.com
created: "2024-01-15"
updated: "2024-06-20"

# Default behavior for unmatched actions
defaults:
  action: deny
  violation_mode: sigkill
  log_level: info

# Global settings
settings:
  max_file_size_mb: 100
  max_network_timeout_seconds: 30
  enable_audit_logging: true
  require_encryption: true

# Pattern definitions
patterns:
  # File system patterns
  - id: allow_workspace_read
    action_type: file_read
    pattern: "^/workspace/.*"
    action: allow
    severity: low
    description: "Allow reading files in workspace"
    
  - id: allow_workspace_write
    action_type: file_write
    pattern: "^/workspace/.*"
    action: allow
    severity: low
    conditions:
      max_size_bytes: 104857600  # 100MB
    
  - id: block_sensitive_files
    action_type: file_read
    pattern: ".*\\.(pem|key|env|credentials|secret)$"
    action: deny
    severity: critical
    message: "Access to sensitive files is prohibited"
    metadata:
      compliance:
        - SOC2
        - HIPAA
        - PCI-DSS
        
  - id: block_system_dirs
    action_type: file_write
    pattern: "^/(etc|usr|bin|sbin|lib|boot)/.*"
    action: deny
    severity: critical
    message: "Writing to system directories is prohibited"

  # Database patterns
  - id: allow_select_queries
    action_type: database_read
    pattern: ".*"
    action: allow
    severity: low
    
  - id: block_ddl_operations
    action_type: database_execute
    pattern: ".*(DROP|TRUNCATE|ALTER|CREATE).*"
    action: deny
    severity: critical
    message: "DDL operations require admin approval"
    
  - id: warn_bulk_updates
    action_type: database_write
    pattern: ".*UPDATE.*WHERE.*"
    action: warn
    severity: medium
    conditions:
      require_where_clause: true
      max_affected_rows: 1000

  # Shell execution patterns
  - id: allow_safe_commands
    action_type: shell_execute
    pattern: "^(ls|cat|grep|find|head|tail|wc|sort|uniq|awk|sed)\\s.*"
    action: allow
    severity: low
    
  - id: block_destructive_commands
    action_type: shell_execute
    pattern: ".*(rm\\s+-rf|sudo|chmod\\s+777|chown|mkfs|fdisk|dd\\s+if=).*"
    action: deny
    severity: critical
    message: "Destructive shell command blocked"
    
  - id: block_network_tools
    action_type: shell_execute
    pattern: ".*(curl|wget|nc|netcat|ssh|scp|rsync).*"
    action: deny
    severity: high
    message: "Network tools must use approved APIs"

  # Network patterns
  - id: allow_internal_apis
    action_type: network_request
    pattern: "^https://.*\\.internal\\.company\\.com/.*"
    action: allow
    severity: low
    
  - id: allow_approved_external
    action_type: network_request
    pattern: "^https://(api\\.github\\.com|api\\.openai\\.com|storage\\.googleapis\\.com)/.*"
    action: allow
    severity: low
    conditions:
      allowed_methods:
        - GET
        - POST
      require_auth_header: true
      
  - id: block_plaintext_http
    action_type: network_request
    pattern: "^http://.*"
    action: deny
    severity: high
    message: "Plaintext HTTP connections are not allowed"
    
  - id: block_other_networks
    action_type: network_request
    pattern: ".*"
    action: deny
    severity: medium
    message: "External network access requires approval"

# Inherited policies (optional)
extends:
  - base_security_policy
  - compliance_policy

# Exception rules (override patterns for specific agents)
exceptions:
  - agent_pattern: "admin_agent_.*"
    patterns:
      - block_system_dirs
      - block_ddl_operations
    reason: "Admin agents have elevated privileges"
    expires: "2024-12-31"
    approved_by: security@company.com</code></pre>
                        </div>

                        <h4>Loading YAML Policies</h4>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import KernelSpace, Policy

# Load policy from YAML file
policy = Policy.from_yaml("policies/enterprise_security.yaml")

# Load policy from YAML string
yaml_content = """
name: quick_policy
default_action: deny
patterns:
  - action_type: file_read
    pattern: ".*"
    action: allow
"""
policy = Policy.from_yaml_string(yaml_content)

# Use the loaded policy
kernel = KernelSpace(policy=policy)

# Validate a YAML policy file
errors = Policy.validate_yaml("policies/my_policy.yaml")
if errors:
    for error in errors:
        print(f"Validation error: {error}")</code></pre>
                        </div>

                        <!-- Action Types -->
                        <h2 id="action-types">Action Types Reference</h2>
                        <p>
                            Agent OS categorizes all agent actions into specific types. Each action type can be 
                            controlled independently through policy patterns.
                        </p>
                        <table class="aos-table">
                            <thead>
                                <tr>
                                    <th>Action Type</th>
                                    <th>Description</th>
                                    <th>Target Format</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>file_read</code></td>
                                    <td>Reading file contents</td>
                                    <td>Absolute file path: <code>/path/to/file.txt</code></td>
                                </tr>
                                <tr>
                                    <td><code>file_write</code></td>
                                    <td>Writing or creating files</td>
                                    <td>Absolute file path: <code>/path/to/file.txt</code></td>
                                </tr>
                                <tr>
                                    <td><code>file_delete</code></td>
                                    <td>Deleting files or directories</td>
                                    <td>Absolute file path: <code>/path/to/file.txt</code></td>
                                </tr>
                                <tr>
                                    <td><code>file_move</code></td>
                                    <td>Moving or renaming files</td>
                                    <td>Source path: <code>/old/path â†’ /new/path</code></td>
                                </tr>
                                <tr>
                                    <td><code>file_chmod</code></td>
                                    <td>Changing file permissions</td>
                                    <td>Path with mode: <code>/path:0755</code></td>
                                </tr>
                                <tr>
                                    <td><code>database_read</code></td>
                                    <td>SELECT queries</td>
                                    <td>SQL query: <code>SELECT * FROM users</code></td>
                                </tr>
                                <tr>
                                    <td><code>database_write</code></td>
                                    <td>INSERT/UPDATE queries</td>
                                    <td>SQL query: <code>INSERT INTO users ...</code></td>
                                </tr>
                                <tr>
                                    <td><code>database_delete</code></td>
                                    <td>DELETE queries</td>
                                    <td>SQL query: <code>DELETE FROM users ...</code></td>
                                </tr>
                                <tr>
                                    <td><code>database_execute</code></td>
                                    <td>DDL and other commands</td>
                                    <td>SQL command: <code>CREATE TABLE ...</code></td>
                                </tr>
                                <tr>
                                    <td><code>shell_execute</code></td>
                                    <td>Running shell commands</td>
                                    <td>Command string: <code>ls -la /home</code></td>
                                </tr>
                                <tr>
                                    <td><code>network_request</code></td>
                                    <td>HTTP/HTTPS requests</td>
                                    <td>Full URL: <code>https://api.example.com/data</code></td>
                                </tr>
                                <tr>
                                    <td><code>network_connect</code></td>
                                    <td>Raw socket connections</td>
                                    <td>Host and port: <code>192.168.1.1:5432</code></td>
                                </tr>
                                <tr>
                                    <td><code>process_spawn</code></td>
                                    <td>Creating child processes</td>
                                    <td>Process command: <code>python script.py</code></td>
                                </tr>
                                <tr>
                                    <td><code>memory_access</code></td>
                                    <td>Shared memory operations</td>
                                    <td>Memory region: <code>shm://shared_data</code></td>
                                </tr>
                                <tr>
                                    <td><code>env_read</code></td>
                                    <td>Reading environment variables</td>
                                    <td>Variable name: <code>API_KEY</code></td>
                                </tr>
                                <tr>
                                    <td><code>env_write</code></td>
                                    <td>Setting environment variables</td>
                                    <td>Variable name: <code>PATH</code></td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Pattern Matching -->
                        <h2 id="pattern-matching">Pattern Matching</h2>
                        <p>
                            Patterns use Python regular expressions (re module) for flexible matching. 
                            Understanding regex patterns is essential for creating effective policies.
                        </p>

                        <h3>Regex Examples</h3>
                        <div class="aos-code-block">
                            <pre><code># Match exact path
pattern: "^/var/log/app\\.log$"

# Match all files in a directory
pattern: "^/data/input/.*"

# Match file extensions
pattern: ".*\\.(txt|csv|json)$"

# Match sensitive file types
pattern: ".*\\.(pem|key|env|secret|password)$"

# Match paths with specific segments
pattern: ".*/config/.*\\.yaml$"

# Match IP addresses (network patterns)
pattern: "^https://192\\.168\\..*"

# Match with negation (use in combination)
pattern: "^(?!.*secret).*\\.txt$"  # .txt files not containing "secret"

# Match SQL patterns
pattern: ".*SELECT.*FROM\\s+users.*"

# Match shell commands with arguments
pattern: "^git\\s+(push|pull|commit).*"</code></pre>
                        </div>

                        <h3>Severity Levels</h3>
                        <p>
                            Severity levels help prioritize alerts and determine response actions. 
                            Higher severity violations trigger more aggressive responses.
                        </p>
                        <table class="aos-table">
                            <thead>
                                <tr>
                                    <th>Level</th>
                                    <th>Value</th>
                                    <th>Use Case</th>
                                    <th>Default Response</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>LOW</code></td>
                                    <td>1</td>
                                    <td>Informational, expected operations</td>
                                    <td>Log only</td>
                                </tr>
                                <tr>
                                    <td><code>MEDIUM</code></td>
                                    <td>2</td>
                                    <td>Potentially risky operations</td>
                                    <td>Log + warn</td>
                                </tr>
                                <tr>
                                    <td><code>HIGH</code></td>
                                    <td>3</td>
                                    <td>Security-sensitive operations</td>
                                    <td>Block + alert</td>
                                </tr>
                                <tr>
                                    <td><code>CRITICAL</code></td>
                                    <td>4</td>
                                    <td>System integrity threats</td>
                                    <td>Block + terminate + alert</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Violation Handling -->
                        <h2 id="violation-handling">Violation Handling Modes</h2>
                        <p>
                            When a policy violation occurs, Agent OS can respond in several ways. 
                            The violation handling mode determines the severity of the response.
                        </p>
                        <table class="aos-table">
                            <thead>
                                <tr>
                                    <th>Mode</th>
                                    <th>Signal</th>
                                    <th>Behavior</th>
                                    <th>Use Case</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>SIGKILL</code></td>
                                    <td><code>AgentSignal.SIGKILL</code></td>
                                    <td>Immediately terminate the agent, block the action</td>
                                    <td>Production environments, critical violations</td>
                                </tr>
                                <tr>
                                    <td><code>SIGSTOP</code></td>
                                    <td><code>AgentSignal.SIGSTOP</code></td>
                                    <td>Pause the agent, block the action, await manual review</td>
                                    <td>Suspicious activity requiring investigation</td>
                                </tr>
                                <tr>
                                    <td><code>SIGWARN</code></td>
                                    <td><code>AgentSignal.SIGWARN</code></td>
                                    <td>Allow the action but emit warning signal</td>
                                    <td>Development environments, soft enforcement</td>
                                </tr>
                                <tr>
                                    <td><code>LOG_ONLY</code></td>
                                    <td>None</td>
                                    <td>Allow the action, log for audit purposes only</td>
                                    <td>Monitoring mode, policy testing</td>
                                </tr>
                            </tbody>
                        </table>

                        <h3>Configuring Violation Modes</h3>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import Policy
from agent_os.policy import ViolationMode

# Global violation mode for the policy
policy = Policy(
    name="strict_policy",
    violation_mode=ViolationMode.SIGKILL
)

# Per-pattern violation mode override
from agent_os import Pattern

# Critical violations terminate immediately
critical_pattern = Pattern(
    action_type="shell_execute",
    pattern=r".*sudo.*",
    action="deny",
    violation_mode=ViolationMode.SIGKILL
)

# Medium violations pause for review
review_pattern = Pattern(
    action_type="database_delete",
    pattern=r".*",
    action="deny",
    violation_mode=ViolationMode.SIGSTOP
)

# Low severity just warns
warn_pattern = Pattern(
    action_type="file_write",
    pattern=r"/tmp/.*",
    action="warn",
    violation_mode=ViolationMode.SIGWARN
)</code></pre>
                        </div>

                        <h3>Custom Violation Handlers</h3>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import KernelSpace, Policy
from agent_os.signals import AgentSignal

# Create policy with custom violation handler
def custom_violation_handler(violation):
    """Handle policy violations with custom logic."""
    print(f"Violation detected: {violation.pattern_id}")
    print(f"Action: {violation.action_type}")
    print(f"Target: {violation.target}")
    print(f"Severity: {violation.severity}")
    
    # Send alert for critical violations
    if violation.severity == "critical":
        send_security_alert(violation)
    
    # Log to external system
    log_to_siem(violation)
    
    # Return the signal to send
    if violation.severity == "critical":
        return AgentSignal.SIGKILL
    elif violation.severity == "high":
        return AgentSignal.SIGSTOP
    else:
        return AgentSignal.SIGWARN

policy = Policy(
    name="custom_handler_policy",
    violation_handler=custom_violation_handler
)

kernel = KernelSpace(policy=policy)</code></pre>
                        </div>

                        <!-- Policy Templates -->
                        <h2 id="policy-templates">Policy Templates</h2>
                        <p>
                            Agent OS includes pre-built policy templates for common compliance frameworks. 
                            These templates can be used directly or customized for your specific needs.
                        </p>

                        <h3 id="hipaa-standard">hipaa_standard</h3>
                        <p>
                            The <strong>hipaa_standard</strong> template implements controls required for 
                            HIPAA compliance in healthcare applications.
                        </p>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import KernelSpace
from agent_os.templates import hipaa_standard

# Load the HIPAA template
policy = hipaa_standard()

# Customize for your environment
policy.add_pattern(Pattern(
    action_type="database_read",
    pattern=r".*patient_records.*",
    action="allow",
    conditions={
        "require_audit_log": True,
        "require_encryption": True
    }
))

kernel = KernelSpace(policy=policy)</code></pre>
                        </div>
                        <p><strong>Key protections:</strong></p>
                        <ul>
                            <li>All PHI access logged with user identification</li>
                            <li>Encryption required for data at rest and in transit</li>
                            <li>Access controls based on minimum necessary principle</li>
                            <li>Automatic session timeout after inactivity</li>
                            <li>Audit trails for all data access and modifications</li>
                        </ul>

                        <h3 id="soc2-compliant">soc2_compliant</h3>
                        <p>
                            The <strong>soc2_compliant</strong> template implements SOC 2 Type II controls 
                            for service organizations.
                        </p>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import KernelSpace
from agent_os.templates import soc2_compliant

# Load the SOC2 template
policy = soc2_compliant()

# Enable specific trust service criteria
policy.enable_criteria([
    "security",
    "availability", 
    "confidentiality"
])

kernel = KernelSpace(policy=policy)</code></pre>
                        </div>
                        <p><strong>Key protections:</strong></p>
                        <ul>
                            <li>Logical and physical access controls</li>
                            <li>Change management procedures enforced</li>
                            <li>Risk assessment and mitigation</li>
                            <li>Incident response procedures</li>
                            <li>Vendor management controls</li>
                        </ul>

                        <h3 id="k12-safe">k12_safe</h3>
                        <p>
                            The <strong>k12_safe</strong> template implements CIPA-compliant content filtering 
                            and safety controls for K-12 educational environments.
                        </p>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import KernelSpace
from agent_os.templates import k12_safe

# Load the K-12 safety template
policy = k12_safe()

# Configure age-appropriate settings
policy.configure(
    age_group="elementary",  # elementary, middle, high
    allow_social_media=False,
    allow_external_search=False,
    content_filter_level="strict"
)

kernel = KernelSpace(policy=policy)</code></pre>
                        </div>
                        <p><strong>Key protections:</strong></p>
                        <ul>
                            <li>Content filtering for inappropriate material</li>
                            <li>Social media access restrictions</li>
                            <li>Personal information disclosure prevention</li>
                            <li>Safe search enforcement</li>
                            <li>Activity monitoring and reporting</li>
                        </ul>

                        <!-- Combining Policies -->
                        <h2 id="combining-policies">Combining and Merging Policies</h2>
                        <p>
                            Multiple policies can be combined to create comprehensive governance. 
                            Agent OS supports several merging strategies for different use cases.
                        </p>

                        <h3>Merge Strategies</h3>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import Policy
from agent_os.templates import hipaa_standard, soc2_compliant

# Load base policies
hipaa = hipaa_standard()
soc2 = soc2_compliant()

# Strict merge: most restrictive rule wins
strict_policy = hipaa.merge(soc2, strategy="strict")

# Permissive merge: least restrictive rule wins
permissive_policy = hipaa.merge(soc2, strategy="permissive")

# Override merge: second policy overrides conflicts
override_policy = hipaa.merge(soc2, strategy="override")

# Custom merge with conflict resolution
def resolve_conflict(pattern1, pattern2):
    """Custom conflict resolution logic."""
    # Prefer higher severity patterns
    if pattern1.severity > pattern2.severity:
        return pattern1
    return pattern2

custom_policy = hipaa.merge(
    soc2, 
    strategy="custom",
    conflict_resolver=resolve_conflict
)</code></pre>
                        </div>

                        <h3>Policy Inheritance</h3>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import Policy, Pattern

# Create a base policy
base_policy = Policy(
    name="base_security",
    default_action="deny",
    patterns=[
        Pattern(
            action_type="file_read",
            pattern=r".*",
            action="allow"
        )
    ]
)

# Create a child policy that inherits from base
child_policy = Policy(
    name="app_specific",
    extends=base_policy,  # Inherit all patterns
    patterns=[
        # Add additional patterns
        Pattern(
            action_type="file_write",
            pattern=r"/app/data/.*",
            action="allow"
        )
    ]
)

# Child inherits all base patterns plus its own</code></pre>
                        </div>

                        <h3>Layered Policy Stack</h3>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import KernelSpace, PolicyStack

# Create a layered policy stack
# Policies are evaluated in order; first match wins
stack = PolicyStack([
    # Layer 1: Agent-specific overrides (highest priority)
    Policy.from_yaml("policies/agent_overrides.yaml"),
    
    # Layer 2: Application-specific rules
    Policy.from_yaml("policies/app_rules.yaml"),
    
    # Layer 3: Compliance requirements
    hipaa_standard(),
    
    # Layer 4: Organization baseline (lowest priority)
    Policy.from_yaml("policies/org_baseline.yaml")
])

kernel = KernelSpace(policy=stack)</code></pre>
                        </div>

                        <!-- Dynamic Policies -->
                        <h2 id="dynamic-policies">Dynamic Policies</h2>
                        <p>
                            Policies can be modified at runtime for adaptive security. 
                            Dynamic policies are useful for responding to threats or changing conditions.
                        </p>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import KernelSpace, Policy, Pattern

kernel = KernelSpace(policy="strict")

# Add a pattern at runtime
kernel.policy.add_pattern(Pattern(
    id="emergency_block",
    action_type="network_request",
    pattern=r".*malicious-domain\.com.*",
    action="deny",
    severity="critical"
))

# Remove a pattern
kernel.policy.remove_pattern("emergency_block")

# Temporarily elevate privileges for an agent
with kernel.policy.elevated_privileges("admin_agent"):
    # Agent has expanded permissions within this block
    result = kernel.execute("admin_agent", admin_task)

# Enable/disable patterns
kernel.policy.disable_pattern("some_pattern_id")
kernel.policy.enable_pattern("some_pattern_id")

# Hot-reload policy from file
kernel.reload_policy("policies/updated_policy.yaml")

# Subscribe to policy changes
def on_policy_change(event):
    print(f"Policy changed: {event.change_type}")
    print(f"Pattern: {event.pattern_id}")

kernel.policy.on_change(on_policy_change)</code></pre>
                        </div>

                        <h3>Conditional Policies</h3>
                        <div class="aos-code-block">
                            <pre><code>from agent_os import Policy, Pattern
from datetime import datetime, time

# Time-based policy adjustments
def business_hours_policy():
    """More permissive during business hours."""
    current_hour = datetime.now().hour
    if 9 <= current_hour < 17:
        return Policy(name="business_hours", default_action="allow")
    else:
        return Policy(name="after_hours", default_action="deny")

# Context-aware patterns
pattern = Pattern(
    action_type="database_write",
    pattern=r".*",
    action="allow",
    conditions={
        "time_range": {"start": "09:00", "end": "17:00"},
        "days": ["monday", "tuesday", "wednesday", "thursday", "friday"],
        "require_mfa": True,
        "max_operations_per_minute": 100
    }
)

# Environment-based policies
import os

if os.environ.get("ENVIRONMENT") == "production":
    policy = Policy.from_yaml("policies/production.yaml")
else:
    policy = Policy.from_yaml("policies/development.yaml")</code></pre>
                        </div>

                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="aos-footer">
        <div class="container">
            <div class="aos-footer-grid">
                <div class="aos-footer-brand">
                    <h4>Agent OS</h4>
                    <p>The Linux kernel for AI agents. Enterprise-grade governance, observability, and control.</p>
                    <span class="aos-footer-version">v0.1.0</span>
                </div>
                <div class="aos-footer-section">
                    <h5>Documentation</h5>
                    <ul>
                        <li><a href="quickstart.html">Quickstart</a></li>
                        <li><a href="api.html">API Reference</a></li>
                        <li><a href="policies.html">Policy Reference</a></li>
                        <li><a href="../examples/index.html">Examples</a></li>
                    </ul>
                </div>
                <div class="aos-footer-section">
                    <h5>Modules</h5>
                    <ul>
                        <li><a href="../modules/cmvk.html">CMVK</a></li>
                        <li><a href="../modules/emk.html">EMK</a></li>
                        <li><a href="../modules/iatp.html">IATP</a></li>
                        <li><a href="../modules/amb.html">AMB</a></li>
                    </ul>
                </div>
                <div class="aos-footer-section">
                    <h5>Resources</h5>
                    <ul>
                        <li><a href="https://github.com/imran-siddique/agent-os">GitHub</a></li>
                        <li><a href="../use-cases/index.html">Use Cases</a></li>
                        <li><a href="../integrations/index.html">Integrations</a></li>
                        <li><a href="../../contact.html">Contact</a></li>
                    </ul>
                </div>
            </div>
            <div class="aos-footer-bottom">
                <p>&copy; 2024 Imran Siddique. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../../script.js"></script>
</body>
</html>
